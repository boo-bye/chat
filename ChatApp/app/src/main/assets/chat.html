<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Chat APP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial;
            background: #f2f2f2;
            display: flex;
            flex-direction: column;
        }
        #messages {
            flex: 1;
            overflow-y: scroll;
            background: #fff;
            padding: 10px;
            border-radius: 6px;
            margin: 10px;
        }
        .msg {
            padding: 6px;
            margin: 4px 0;
            border-radius: 4px;
            display: inline-block;
        }
        .msg.self {
            background: #c8e6c9;
            text-align: right;
        }
        .msg.friend {
            background: #e7f1ff;
            text-align: left;
        }
        input {
            width: 70%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #aaa;
            font-size: 16px;
            -webkit-appearance: none;
            -webkit-user-select: text;
            user-select: text;
        }

        input[type="text"] {
            -webkit-text-fill-color: #000;
        }
        button {
            width: 25%;
            padding: 10px;
            margin-left: 1%;
            background: #4CAF50;
            color: #fff;
            border: none;
            border-radius: 4px;
        }
        #controls {
            display: flex;
            justify-content: space-between;
            margin: 10px;
            flex-shrink: 0;
        }
    </style>
</head>
<body>

<h2>ğŸ’¬ Hybrid Chat</h2>
<p>è¾“å…¥ä½ çš„ç”¨æˆ·IDï¼š<input id="userid" type="text" inputmode="text" placeholder="User1"></p>

<div id="messages"></div>

<div id="controls">
    <input id="text" type="text" inputmode="text" placeholder="è¾“å…¥æ¶ˆæ¯...">
    <button onclick="sendMessage()">å‘é€</button>
    <button onclick="getDevice()">è®¾å¤‡</button>
    <button onclick="requestPermissions()">æƒé™</button>
    <button onclick="sendAppNotification()">é€šçŸ¥</button>
</div>

<script>
    // WebSocket è¿æ¥æœåŠ¡å™¨
    let ws = new WebSocket("ws://10.0.2.2:8080");

    ws.onopen = () => addMsg("ğŸŸ¢ å·²è¿æ¥æœåŠ¡å™¨", false);
    ws.onmessage = (msg) => addMsg(msg.data, false);

    function sendMessage() {
        let text = document.getElementById("text").value;
        if(text.trim() === "") return;

        let id = document.getElementById("userid").value || "User";
        let fullMsg = id + ": " + text;

        ws.send(fullMsg);
        addMsg(fullMsg, true); // è‡ªå·±å‘çš„æ¶ˆæ¯
        document.getElementById("text").value = "";
    }

    function addMsg(text, isMe){
        let box = document.getElementById("messages");
        let div = document.createElement("div");
        div.className = "msg " + (isMe ? "self" : "friend");
        div.innerText = text;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    function getDevice() {
        if(Android && Android.getDeviceInfo) {
            alert(Android.getDeviceInfo());
        } else {
            alert("æ— æ³•è·å–è®¾å¤‡ä¿¡æ¯");
        }
    }

    // è¯·æ±‚éº¦å…‹é£å’Œæ‘„åƒå¤´æƒé™
    function requestPermissions() {
        if(Android) {
            let micResult = Android.requestMicrophonePermission();
            let cameraResult = Android.requestCameraPermission();
            addMsg("ğŸ¤ éº¦å…‹é£: " + micResult, false);
            addMsg("ğŸ“¹ æ‘„åƒå¤´: " + cameraResult, false);
        } else {
            alert("æ— æ³•è·å–æƒé™");
        }
    }

    // å‘é€åº”ç”¨é€šçŸ¥
    function sendAppNotification() {
        if(Android) {
            Android.sendNotification("æ–°æ¶ˆæ¯", "ä½ æœ‰ä¸€æ¡æ–°çš„èŠå¤©æ¶ˆæ¯ï¼");
            addMsg("ğŸ“¢ å·²å‘é€é€šçŸ¥", false);
        } else {
            alert("æ— æ³•å‘é€é€šçŸ¥");
        }
    }
</script>

</body>
</html>